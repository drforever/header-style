/* 顶部导航栏样式组件 */
/* 使用最高优先级确保稳定性 */

// 自定义字体
@font-face {
  font-family: 'CustomTitle';
  src: url($tencent-w7) format('truetype');
  font-weight: normal;
  font-style: normal;
}

// 使用多重选择器提高优先级，确保覆盖所有情况
html body .d-header-wrap .d-header,
html .d-header-wrap .d-header,
.d-header-wrap .d-header,
.d-header {
  height: 3.5em !important;
  background-color: #3B66F5 !important;
  background: #3B66F5 !important;
  border-bottom: none !important;
}

// 导航栏容器高度
.d-header-wrap {
  height: 3.5em !important;
}

.d-header .wrap {
  height: 100%;
}

// 站点标题和Logo - 使用自定义字体
html body .d-header .title a,
html body .d-header .title .header-title,
.d-header .title a,
.d-header .title .header-title,
.d-header-wrap .d-header .title a {
  color: #ffffff !important;
  font-family: 'CustomTitle', sans-serif !important;
}

// 站点标题容器 - 图标和文字垂直居中对齐
html body .d-header .title,
.d-header .title {
  display: flex !important;
  align-items: center !important;
}

html body .d-header .logo-wrapper,
.d-header .logo-wrapper,
html body .d-header .home-logo-wrapper-outlet,
.d-header .home-logo-wrapper-outlet {
  display: flex !important;
  align-items: center !important;
}

html body .d-header .title a,
.d-header .title a {
  display: flex !important;
  align-items: center !important;
  gap: 8px;
}

// 站点文字Logo垂直居中
html body .d-header #site-text-logo,
.d-header #site-text-logo,
html body .d-header .text-logo,
.d-header .text-logo {
  display: flex !important;
  align-items: center !important;
  line-height: 1.2 !important;
  vertical-align: middle !important;
  overflow: visible !important;
  padding-bottom: 4px !important;
  height: auto !important;
  min-height: 1.5em !important;
}

// 确保标题容器不截断内容
html body .d-header .title,
.d-header .title,
html body .d-header .title a,
.d-header .title a,
html body .d-header .home-logo-wrapper-outlet,
.d-header .home-logo-wrapper-outlet {
  overflow: visible !important;
}

// 所有图标 - 使用最广泛的选择器
html body .d-header .d-icon,
.d-header .d-icon,
.d-header .btn .d-icon,
.d-header .btn-flat .d-icon,
.d-header .header-dropdown-toggle .d-icon,
.d-header-wrap .d-header .d-icon,
.d-header svg.d-icon {
  color: #ffffff !important;
  fill: #ffffff !important;
}

// 按钮
html body .d-header .btn,
html body .d-header .btn-flat,
.d-header .btn,
.d-header .btn-flat,
.d-header .icon,
.d-header .header-buttons button {
  color: #ffffff !important;
}

// 汉堡菜单图标
.d-header .hamburger-dropdown .d-icon,
.d-header .menu-panel .d-icon {
  color: #ffffff !important;
}

// ============================================
// 隐藏原始搜索按钮（用内嵌搜索框替代）
// ============================================
html body .d-header .search-dropdown,
.d-header .search-dropdown {
  display: none !important;
}

// 确保图标列表垂直居中
html body .d-header .icons,
.d-header .icons {
  display: flex !important;
  align-items: center !important;
}

// ============================================
// 内嵌搜索框 - 圆角搜索栏（放大镜 + 真实输入框）
// ============================================
.d-header .before-header-panel-outlet {
  display: flex !important;
  align-items: center !important;
  flex: 1 !important;
  justify-content: flex-end !important;
  padding-right: 8px !important;
}

.header-inline-search {
  display: flex !important;
  align-items: center !important;
  position: relative !important;
  background: rgba(255, 255, 255, 0.1) !important;
  border: 1px solid rgba(255, 255, 255, 0.15) !important;
  border-radius: 20px !important;
  min-width: 220px !important;
  max-width: 320px !important;
  height: 32px !important;
  transition: all 0.2s ease !important;

  &:hover {
    background: rgba(255, 255, 255, 0.15) !important;
    border-color: rgba(255, 255, 255, 0.25) !important;
  }

  &:focus-within {
    background: rgba(255, 255, 255, 0.18) !important;
    border-color: rgba(255, 255, 255, 0.3) !important;
  }

  // 左侧放大镜图标（纯装饰）
  &__icon {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 0 4px 0 12px !important;
    flex-shrink: 0 !important;
    pointer-events: none !important;

    .d-icon {
      color: rgba(255, 255, 255, 0.5) !important;
      fill: rgba(255, 255, 255, 0.5) !important;
      width: 14px !important;
      height: 14px !important;
    }
  }

  // SearchMenu 容器
  .search-menu-container {
    flex: 1 !important;
    display: flex !important;
    align-items: center !important;
    position: static !important;
    min-width: 0 !important;
  }

  // 输入框包装器
  .search-input-wrapper {
    flex: 1 !important;
    display: flex !important;
    align-items: center !important;
    min-width: 0 !important;
  }

  .search-input {
    display: flex !important;
    align-items: center !important;
    flex: 1 !important;
    border: none !important;
    background: transparent !important;
    padding: 0 !important;
    margin: 0 !important;
    min-width: 0 !important;
    box-shadow: none !important;
    outline: none !important;
    border-radius: 0 !important;

    &:focus-within {
      box-shadow: none !important;
      outline: none !important;
    }
  }

  // 真实搜索输入框
  .search-term__input {
    flex: 1 !important;
    background: transparent !important;
    border: none !important;
    outline: none !important;
    color: #ffffff !important;
    font-size: 13px !important;
    padding: 0 8px 0 4px !important;
    height: 30px !important;
    min-width: 0 !important;
    caret-color: #ffffff !important;

    &::placeholder {
      color: rgba(255, 255, 255, 0.4) !important;
    }

    &:focus {
      outline: none !important;
      box-shadow: none !important;
    }
  }

  // 加载、清除、高级搜索等按钮区
  .searching {
    display: flex !important;
    align-items: center !important;
    flex-shrink: 0 !important;
    padding-right: 4px !important;

    .btn {
      background: transparent !important;
      border: none !important;
      padding: 0 6px !important;
      min-width: auto !important;
      height: auto !important;

      .d-icon {
        color: rgba(255, 255, 255, 0.5) !important;
        fill: rgba(255, 255, 255, 0.5) !important;
        width: 12px !important;
        height: 12px !important;
      }

      &:hover .d-icon {
        color: rgba(255, 255, 255, 0.8) !important;
        fill: rgba(255, 255, 255, 0.8) !important;
      }
    }
  }

  // 下拉结果面板 - 定位到搜索栏下方
  .search-menu-panel {
    position: absolute !important;
    top: calc(100% + 6px) !important;
    left: 0 !important;
    right: auto !important;
    width: 420px !important;
    max-width: 90vw !important;
    background: #ffffff !important;
    border: 1px solid rgba(0, 0, 0, 0.08) !important;
    border-radius: 12px !important;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15) !important;
    z-index: 1000 !important;
    padding: 0 !important;
    overflow: hidden !important;

    .panel-body-contents {
      max-height: 400px !important;
      overflow-y: auto !important;
      padding: 0 !important;
    }
  }

  // topic context 标签
  .search-context {
    flex-shrink: 0 !important;
    margin: 0 4px !important;
    padding: 2px 8px !important;
    font-size: 11px !important;
    border-radius: 12px !important;
    background: rgba(255, 255, 255, 0.15) !important;
    border-color: rgba(255, 255, 255, 0.2) !important;
    color: #ffffff !important;

    .d-icon {
      color: #ffffff !important;
      fill: #ffffff !important;
    }
  }
}

// 用户头像边框
.d-header .current-user .avatar {
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
}

// 匿名模式按钮 - 圆角透明样式（与搜索框一致）
html body .d-header .anonymous-toggle-btn,
.d-header .anonymous-toggle-btn {
  display: flex !important;
  align-items: center !important;
  background: rgba(255, 255, 255, 0.1) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  border-radius: 20px !important;
  padding: 0 16px !important;
  height: 32px !important;
  color: #ffffff !important;
  transition: all 0.2s ease !important;
  
  .d-icon {
    color: #ffffff !important;
  }
  
  &:hover {
    background: rgba(255, 255, 255, 0.15) !important;
  }
}

// 匿名模式按钮 - 激活状态
html body .d-header .anonymous-toggle-btn.is-anonymous,
.d-header .anonymous-toggle-btn.is-anonymous {
  background: rgba(255, 255, 255, 0.1) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  color: #ffffff !important;
  
  .d-icon {
    color: #ffffff !important;
  }
  
  &:hover {
    background: rgba(255, 255, 255, 0.15) !important;
  }
}

// 下拉菜单箭头
.d-header .anonymous-toggle-btn .d-icon-caret-down {
  color: inherit !important;
}

// 确保hover状态也使用固定颜色
html body .d-header .btn:hover,
html body .d-header .btn-flat:hover,
.d-header .btn:hover,
.d-header .btn-flat:hover,
.d-header .icon:hover {
  color: #ffffff !important;
  
  .d-icon {
    color: #ffffff !important;
  }
}

// 导航栏上的头像按钮 - 保持透明背景
.d-header .current-user,
.d-header .header-dropdown-toggle,
.d-header .btn.no-text.icon.btn-flat {
  background-color: transparent !important;
  background: transparent !important;
}

// ============================================
// 用户下拉菜单样式 - 确保文字可见
// ============================================

// 最外层下拉菜单容器 - 仅对用户菜单应用
html body .user-menu.revamped.menu-panel.drop-down,
html body .user-menu.revamped {
  background-color: #ffffff !important;
  background: #ffffff !important;
  color: #333333 !important;
  
  // 内部所有元素
  *:not(.btn-primary):not(.btn-primary *) {
    color: #333333 !important;
  }
  
  // 图标
  .d-icon,
  svg {
    color: #333333 !important;
    fill: #333333 !important;
  }
}

// 下拉面板内部容器
html body .panel-body,
html body .panel-body-contents,
html body .menu-tabs-container,
html body .quick-access-panel,
html body .panel-body-bottom {
  background-color: #ffffff !important;
  background: #ffffff !important;
  color: #333333 !important;
}

// 菜单内所有文字 - 仅对用户菜单应用
html body .user-menu.revamped *,
html body .user-menu.revamped .panel-body *,
html body .user-menu.revamped .panel-body-contents *,
html body .user-menu.revamped .quick-access-panel *,
html body .user-menu.revamped .menu-tabs-container *,
html body .user-menu.revamped .panel-body-bottom * {
  color: #333333 !important;
}

// 菜单内图标 - 仅对用户菜单应用
html body .user-menu.revamped .d-icon,
html body .user-menu.revamped svg,
html body .user-menu.revamped .panel-body .d-icon,
html body .user-menu.revamped .panel-body svg,
html body .user-menu.revamped .quick-access-panel .d-icon,
html body .user-menu.revamped .quick-access-panel svg {
  color: #333333 !important;
  fill: #333333 !important;
}

// 菜单内按钮 - 仅对用户菜单应用
html body .user-menu.revamped .btn,
html body .user-menu.revamped .btn-flat,
html body .user-menu.revamped .panel-body .btn,
html body .user-menu.revamped .panel-body .btn-flat,
html body .user-menu.revamped .panel-body-bottom .btn,
html body .user-menu.revamped .panel-body-bottom .btn-flat {
  background-color: transparent !important;
  color: #333333 !important;
}

// 主按钮保持蓝色 - 仅对用户菜单应用
html body .user-menu.revamped .btn-primary,
html body .user-menu.revamped .panel-body .btn-primary,
html body .user-menu.revamped .panel-body-bottom .btn-primary {
  background-color: #3B66F5 !important;
  color: #ffffff !important;
  
  * {
    color: #ffffff !important;
  }
}

// ============================================
// 搜索下拉面板内容样式
// ============================================

// 隐藏原始搜索弹框（SearchMenuWrapper 由 search.visible 控制的）
.d-header .search-menu.glimmer-search-menu {
  display: none !important;
}

// 搜索面板内元素颜色修正（覆盖 header 的白色规则）
.header-inline-search .search-menu-panel {
  * {
    color: #333333;
  }

  .d-icon,
  svg {
    color: #666666 !important;
    fill: #666666 !important;
  }

  .btn {
    color: #333333 !important;

    .d-icon {
      color: #666666 !important;
      fill: #666666 !important;
    }
  }

  // 结果区域
  .results {
    border-radius: 0 !important;
    background: transparent !important;
    padding: 0 !important;

    // 搜索结果分类标题（如 "话题"）
    .heading {
      padding: 8px 16px 4px !important;

      &:not(:first-child) {
        border-top: 1px solid rgba(0, 0, 0, 0.06) !important;
        margin-top: 4px !important;
      }

      h4 {
        margin: 0 !important;
        font-size: 11px !important;
        font-weight: 600 !important;
        color: #999999 !important;
        text-transform: uppercase !important;
        letter-spacing: 0.5px !important;
      }
    }

    // ---- topic/post 搜索结果 ----
    .search-result-topic,
    .search-result-post {
      .list {
        padding: 0 !important;
        margin: 0 !important;
        list-style: none !important;
      }

      .item {
        border-bottom: 1px solid rgba(0, 0, 0, 0.04) !important;

        &:last-child {
          border-bottom: none !important;
        }
      }

      .search-link {
        display: flex !important;
        flex-direction: column !important;
        align-items: flex-start !important;
        padding: 10px 16px !important;
        gap: 4px !important;
        text-decoration: none !important;
        transition: background 0.12s ease !important;

        &:hover {
          background-color: #f5f7fa !important;
        }

        &:focus {
          background-color: #f0f2f5 !important;
          outline: none !important;
        }
      }

      // topic 容器 - 垂直排列
      .topic {
        display: flex !important;
        flex-direction: column !important;
        gap: 2px !important;
        width: 100% !important;
      }

      .first-line {
        display: flex !important;
        align-items: center !important;
        flex-wrap: wrap !important;
        gap: 4px !important;
      }

      // 标题
      .topic-title {
        font-size: 14px !important;
        font-weight: 600 !important;
        color: #1a1a1a !important;
        line-height: 1.4 !important;
        overflow-wrap: anywhere !important;

        a {
          color: inherit !important;
          text-decoration: none !important;
        }
      }

      // 第二行：分类 + 标签
      .second-line {
        display: flex !important;
        align-items: center !important;
        flex-wrap: wrap !important;
        gap: 4px 8px !important;
        margin-top: 2px !important;

        .badge-category__wrapper {
          font-size: 12px !important;
        }

        .discourse-tag {
          font-size: 11px !important;
          color: #888 !important;
        }
      }

      // 摘要
      .blurb {
        font-size: 13px !important;
        color: #666666 !important;
        line-height: 1.5 !important;
        overflow-wrap: break-word !important;
        word-break: break-word !important;
        display: -webkit-box !important;
        -webkit-line-clamp: 2 !important;
        -webkit-box-orient: vertical !important;
        overflow: hidden !important;
        width: 100% !important;
      }

      .blurb__separator {
        color: #999 !important;
      }
    }

    // ---- 分类/标签/用户/组 结果 ----
    .search-result-category,
    .search-result-tag,
    .search-result-user,
    .search-result-group {
      .search-link {
        display: flex !important;
        align-items: center !important;
        padding: 8px 16px !important;
        gap: 8px !important;
        text-decoration: none !important;

        &:hover {
          background-color: #f5f7fa !important;
        }
      }
    }

    // 搜索提示（初始选项）
    .search-menu-initial-options {
      .search-link {
        padding: 8px 16px !important;

        &:hover {
          background-color: #f5f7fa !important;
        }
      }
    }
  }

  // 搜索提示文字
  .search-random-quick-tip {
    padding: 8px 16px !important;
    font-size: 12px !important;
    color: #999 !important;
  }

  // "更多结果" 链接
  .more-link {
    padding: 8px 16px !important;
    border-top: 1px solid rgba(0, 0, 0, 0.06) !important;

    a {
      color: #3B66F5 !important;
      font-size: 13px !important;
      text-decoration: none !important;
    }
  }

  // 无结果提示
  .no-results {
    padding: 16px !important;
    color: #999 !important;
    font-size: 13px !important;
  }

  // 滚动条
  .panel-body-contents {
    &::-webkit-scrollbar {
      width: 6px;
    }

    &::-webkit-scrollbar-track {
      background: transparent;
    }

    &::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.08);
      border-radius: 3px;

      &:hover {
        background: rgba(0, 0, 0, 0.12);
      }
    }
  }

  // 加载状态
  .loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px 16px !important;
    color: #999 !important;
    font-size: 13px !important;
  }
}

// ============================================
// 隐藏用户菜单中的特定标签页
// ============================================

// 隐藏 "消息" 标签页 (messages)
#user-menu-button-messages {
  display: none !important;
}

#quick-access-messages {
  display: none !important;
}

// 隐藏 "书签" 标签页 (bookmarks)
#user-menu-button-bookmarks {
  display: none !important;
}

#quick-access-bookmarks {
  display: none !important;
}

// 隐藏 "其他通知" 标签页 (other-notifications)
#user-menu-button-other-notifications {
  display: none !important;
}

#quick-access-other-notifications {
  display: none !important;
}

// ============================================
// 头像后面显示用户名
// ============================================
.header-username {
  display: flex !important;
  align-items: center !important;
  color: #ffffff !important;
  font-size: 14px !important;
  font-weight: 500 !important;
  margin-left: 8px !important;
  white-space: nowrap !important;
  max-width: 120px !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

// 匿名模式时隐藏用户名
body.anonymous-mode .header-username,
html body.anonymous-mode .header-username {
  display: none !important;
}

// 右侧导航面板整体左移
.d-header .panel {
  margin-right: 0 !important;
  padding-right: 0 !important;
}

// 图标区域紧凑
.d-header .icons.d-header-icons {
  margin-left: 8px !important;
}
